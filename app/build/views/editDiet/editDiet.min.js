/*! fooddportsweb - v0.0.0 - 2017-01-21 */"use strict";angular.module("myApp.editDiet",["ngRoute","ngFileUpload"]).config(["$routeProvider",function(a){a.when("/editDiet/:dietid",{templateUrl:"views/editDiet/editDiet.html",controller:"EditDietCtrl"})}]).controller("EditDietCtrl",function(a,b,c,d,e,f,g,h){a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),"chef"!=a.storageuser.role&&(window.location="#!/dashboard"),a.diet={},b.get(urlapi+"diets/"+c.dietid).then(function(b){console.log("data success"),console.log(b),a.diet=b.data},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.meals=[],a.addMeal=function(){a.meals.push({title:"",submeals:[]})},a.delMeal=function(b){var c=a.meals.indexOf(b);a.meals.splice(c,1)},a.addSubmeal=function(b){var c=a.meals.indexOf(b);a.meals[c].submeals.push({title:"",description:"",amount:{unit:"",quantity:""},nutritional:{kcal:"",proteins:"",carbohidrates:"",fats:"",vitamins:""}})},a.addDay=function(){d.show(d.simple().textContent("Adding new day").position("bottom right").hideDelay(3e3));var e={day:{title:a.newDay.title,description:a.newDay.description,meals:a.meals}};console.log(e),b({url:urlapi+"diets/"+c.dietid+"/days",method:"POST",data:e}).then(function(b){console.log("day added, response: "),console.log(b.data),a.diet=b.data,a.newDay={},a.meals=[]},function(a){d.show(d.simple().textContent("Failed on generating new day for the diet").position("bottom right").hideDelay(3e3))})},a.uploadFile=function(b,c){console.log(c);var d=new Date;a.title="Image ("+d.getDate()+" - "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+")",a.meals[c].imgfile=b,a.meals[c].imgfile&&b&&!b.$error&&(console.log(b),b.upload=g.upload({url:"https://api.cloudinary.com/v1_1/"+h.config().cloud_name+"/upload",data:{upload_preset:h.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title,file:b},headers:{"X-Access-Token":void 0}}).progress(function(a){b.progress=Math.round(100*a.loaded/a.total),b.status="Uploading... "+b.progress+"%"}).success(function(d,f,g,h){console.log(d.url),a.meals[c].img=d.url,e.photos=e.photos||[],d.context={custom:{photo:a.title}},b.result=d,e.photos.push(d)}).error(function(a,c,d,e){b.result=a}))}});