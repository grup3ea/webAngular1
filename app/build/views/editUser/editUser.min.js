/*! fooddportsweb - v0.0.0 - 2017-01-22 */"use strict";angular.module("myApp.editUser",["ngRoute","ngAnimate","toastr"]).config(["$routeProvider",function(a){a.when("/editUser/:userid",{templateUrl:"views/editUser/editUser.html",controller:"EditUserCtrl"})}]).controller("EditUserCtrl",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){console.log(c),a.urlImg=c.urlImg,a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),a.storageuser._id!=c.userid&&(window.location="#!/user"+c.userid),a.user={},b.get(urlapi+"users/"+c.userid).then(function(b){a.user=b.data,localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),console.log(a.storageuser)},function(a,b){}).then(function(a){}),a.updateUser=function(){b({url:urlapi+"users/"+c.userid,method:"PUT",data:a.user}).then(function(b){console.log(b),a.user=b.data,localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),i.success("User updated"),window.location="#!/user/"+a.storageuser._id},function(){i.success("Failed on updating user")})},a.calculateAge=function(a){var b=new Date(a),c=Date.now()-b,d=new Date(c);return c=Math.abs(d.getUTCFullYear()-1970)},a.uploadFileAvatar=function(b,c){console.log(c);var e=new Date;a.title="Image ("+e.getDate()+" - "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+")",a.user.imgfileAvatar=b,a.user.imgfileAvatar&&b&&!b.$error&&(console.log(b),b.upload=f.upload({url:"https://api.cloudinary.com/v1_1/"+g.config().cloud_name+"/upload",data:{upload_preset:g.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title,file:b},headers:{"X-Access-Token":void 0}}).progress(function(a){b.progress=Math.round(100*a.loaded/a.total),b.status="Uploading... "+b.progress+"%"}).success(function(c,e,f,g){console.log(c.url),a.user.avatar=c.url,d.photos=d.photos||[],c.context={custom:{photo:a.title}},b.result=c,d.photos.push(c)}).error(function(a,c,d,e){b.result=a}))},a.uploadFileBackground=function(b,c){console.log(c);var e=new Date;a.title="Image ("+e.getDate()+" - "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+")",a.user.imgfileBackground=b,a.user.imgfileBackground&&b&&!b.$error&&(console.log(b),b.upload=f.upload({url:"https://api.cloudinary.com/v1_1/"+g.config().cloud_name+"/upload",data:{upload_preset:g.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title,file:b},headers:{"X-Access-Token":void 0}}).progress(function(a){b.progress=Math.round(100*a.loaded/a.total),b.status="Uploading... "+b.progress+"%"}).success(function(c,e,f,g){console.log(c.url),a.user.background=c.url,d.photos=d.photos||[],c.context={custom:{photo:a.title}},b.result=c,d.photos.push(c)}).error(function(a,c,d,e){b.result=a}))},a.showImgComplete=function(b,c){console.log(c),h.show({controller:j,templateUrl:"views/user/imgComplete.tmpl.html",locals:{urlImg:c},parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:a.customFullscreen})},a.addDiscipline=function(){a.user.disciplines.push({name:""})}});