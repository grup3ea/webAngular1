/*! fooddportsweb - v0.0.0 - 2017-01-21 */"use strict";angular.module("myApp.editRoutine",["ngRoute","ngFileUpload","ngAnimate","toastr"]).config(["$routeProvider",function(a){a.when("/editRoutine/:routineid",{templateUrl:"views/editRoutine/editRoutine.html",controller:"EditRoutineCtrl"})}]).controller("EditRoutineCtrl",function(a,b,c,d,e,f,g,h,i,j){a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),"trainer"!=a.storageuser.role&&(window.location="#!/dashboard"),a.routine={},b.get(urlapi+"routines/"+c.routineid).then(function(b){console.log("data success"),console.log(b),a.routine=b.data},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.exercises=[{}],a.addExercise=function(){a.exercises.push({title:"",description:"",img:"",weight:"",distance:"",reps:"",series:"",imgfile:{}})},a.delExercise=function(b){var c=a.exercises.indexOf(b);a.exercises.splice(c,1)},a.addDay=function(){d.show(d.simple().textContent("Adding new day").position("bottom right").hideDelay(3e3));var e={day:{title:a.newDay.title,description:a.newDay.description,exercises:a.exercises}};console.log(e),b({url:urlapi+"routines/"+c.routineid+"/days",method:"POST",data:e}).then(function(b){console.log("day added, response: "),console.log(b.data),a.routine=b.data,a.newDay={},a.exercises=[{title:"",description:"",img:"",weight:"",distance:"",reps:"",series:""}]},function(a){d.show(d.simple().textContent("Failed on generating new routine").position("bottom right").hideDelay(3e3))})},a.deleteRoutine=function(c){var d=i.confirm().title("Delete this routine?").textContent("Are you sure?").ariaLabel("Lucky day").targetEvent(c).ok("Yes, delete").cancel("Cancel");i.show(d).then(function(){b({url:urlapi+"routines/"+a.routine._id,method:"Delete"}).then(function(a){console.log("response: "),console.log(a.data),j.success("Routine deleted!"),window.location="#!/clients"},function(a){j.error("Failed on deleting routine")})},function(){j.info("Operation canceled")})},a.uploadFile=function(b,c){console.log(c);var d=new Date;a.title="Image ("+d.getDate()+" - "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+")",a.exercises[c].imgfile=b,a.exercises[c].imgfile&&b&&!b.$error&&(console.log(b),b.upload=g.upload({url:"https://api.cloudinary.com/v1_1/"+h.config().cloud_name+"/upload",data:{upload_preset:h.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title,file:b},headers:{"X-Access-Token":void 0}}).progress(function(a){b.progress=Math.round(100*a.loaded/a.total),b.status="Uploading... "+b.progress+"%"}).success(function(d,f,g,h){console.log(d.url),a.exercises[c].img=d.url,e.photos=e.photos||[],d.context={custom:{photo:a.title}},b.result=d,e.photos.push(d)}).error(function(a,c,d,e){b.result=a}))}});