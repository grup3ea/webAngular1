/*! fooddportsweb - v0.0.0 - 2017-01-21 */"use strict";angular.module("myApp.dashboard",["ngRoute","ui.calendar","chart.js"]).config(["$routeProvider",function(a){a.when("/dashboard",{templateUrl:"views/dashboard/dashboard.html",controller:"DashboardCtrl"})}]).controller("DashboardCtrl",function(a,b,c,d,e,f,g,h){localStorage.getItem("fs_web_token")?console.log("user logged"):(console.log("no logged"),e.location="#!/login"),a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),a.data=[],a.labels=[],"user"==a.storageuser.role?(d.get(urlapi+"users/"+a.storageuser._id).then(function(b){console.log("data success"),console.log(b),localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=b.data,console.log("generant data de gràfic"),a.data=[],a.labels=[];for(var c=a.storageuser.points.history[0].date,d=0,e=0;e<a.storageuser.points.history.length;e++)h("date")(c,"dd.MM.y")==h("date")(a.storageuser.points.history[e].date,"dd.MM.y")?(d=+d+ +a.storageuser.points.history[e].value,console.log("operació "+a.storageuser.points.history[e].value+" --> total: "+d)):(a.data.push(d),a.labels.push(h("date")(c,"dd.MM.y")),console.log("guardant dades del dia fins ara. canvi de dia."),d=0,d=+d+ +a.storageuser.points.history[e].value,c=a.storageuser.points.history[e].date,console.log("dia nou: "+h("date")(c,"dd.MM.y")),console.log("operació "+a.storageuser.points.history[e].value+" --> total: "+d));a.data.push(d),a.labels.push(h("date")(c,"dd.MM.y")),console.log("algoritme de generació de la data del gràfic completat"),console.log(a.data),console.log(a.labels)},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.deleteSelectedDiets=function(){for(var b=[],c=0;c<a.storageuser.diets.length;c++)1==a.storageuser.diets[c].todelete&&b.push(a.storageuser.diets[c]);console.log(b),d({url:urlapi+"diets/choose",method:"DELETE",data:{dietsToDelete:b}}).then(function(b){console.log(b),localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=b.data},function(a){console.log(a)})}):"trainer"==a.storageuser.role?(d.get(urlapi+"trainers/"+a.storageuser._id).then(function(b){console.log("data success"),console.log(b),localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=b.data,console.log("generant data de gràfic"),a.data=[],a.labels=[];for(var c=a.storageuser.points.history[0].date,d=0,e=0;e<a.storageuser.points.history.length;e++)h("date")(c,"dd.MM.y")==h("date")(a.storageuser.points.history[e].date,"dd.MM.y")?(d=+d+ +a.storageuser.points.history[e].value,console.log("operació "+a.storageuser.points.history[e].value+" --> total: "+d)):(a.data.push(d),a.labels.push(h("date")(c,"dd.MM.y")),console.log("guardant dades del dia fins ara. canvi de dia."),d=0,d=+d+ +a.storageuser.points.history[e].value,c=a.storageuser.points.history[e].date,console.log("dia nou: "+h("date")(c,"dd.MM.y")),console.log("operació "+a.storageuser.points.history[e].value+" --> total: "+d));a.data.push(d),a.labels.push(h("date")(c,"dd.MM.y")),console.log("algoritme de generació de la data del gràfic completat"),console.log(a.data),console.log(a.labels)},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.acceptPetition=function(b,c){var e=f.confirm().title("Accept this petition?").textContent("If you accept, this client will appear in your clients list, and you will be able to create routines for this client.").ariaLabel("Lucky day").targetEvent(b).ok("Confirm").cancel("Cancel");f.show(e).then(function(){d({url:urlapi+"trainers/acceptClientPetition",method:"POST",data:{petitionid:c}}).then(function(b){console.log("response: "),console.log(b.data),a.storageuser=b.data},function(a){g.show(g.simple().textContent("Failed on generating new routine").position("bottom right").hideDelay(3e3))})},function(){g.show(g.simple().textContent("Operation canceled").position("bottom right").hideDelay(3e3))})}):"chef"==a.storageuser.role&&(d.get(urlapi+"chefs/"+a.storageuser._id).then(function(b){console.log("data success"),console.log(b),localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=b.data},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.createDiet=function(a){var b=f.prompt().title("Add new diet").textContent("Name the diet").placeholder("Diet name").ariaLabel("Dog name").initialValue("").targetEvent(a).ok("Create Diet").cancel("Cancel");f.show(b).then(function(a){g.show(g.simple().textContent("Creating new diet: "+a).position("bottom right").hideDelay(3e3)),d({url:urlapi+"diets",method:"POST",data:{title:a}}).then(function(a){console.log("response: "),console.log(a.data),e.location="#!/editDiet/"+a.data._id},function(a){g.show(g.simple().textContent("Failed on generating new diet").position("bottom right").hideDelay(3e3))})},function(){g.show(g.simple().textContent("New Diet canceled").position("bottom right").hideDelay(3e3))})})});