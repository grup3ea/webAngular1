/*! fooddportsweb - v0.0.0 - 2017-01-22 */"use strict";angular.module("myApp.user",["ngRoute","ngAnimate","toastr"]).config(["$routeProvider",function(a){a.when("/user/:userid",{templateUrl:"views/user/user.html",controller:"UserCtrl"})}]).controller("UserCtrl",function(a,b,c,d,e,f,g,h){function i(a,b,c){console.log(c),a.urlImg=c.urlImg,a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),a.user={},b.get(urlapi+"users/"+c.userid).then(function(b){console.log("data success"),console.log(b),a.user=b.data,a.user._id==a.storageuser._id&&(localStorage.setItem("fs_web_userdata",JSON.stringify(a.user)),a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")))},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.userCategory=function(){if("user"==a.user.role){if(a.user.points&&a.user.points.total)return a.user.points.total<50?"Noob":a.user.points.total<200?"cadet":a.user.points.total<500?"Begginer":a.user.points.total<800?"Haciendo IO":a.user.points.total<1500?"Master of Food & Sports":a.user.points.total<3e3?"Aprobaste API":a.user.points.total<5e3?"Acabando EA":a.user.points.total<1e4?"4t de Carrera":a.user.points.total<15e3?"Digievolucionando":a.user.points.total<2e4?"4th Level Sayan":a.user.points.total<5e4?"Overlord":"Master of Universe"}else if("trainer"==a.user.role&&a.user.points&&a.user.points.total)return a.user.points.total<50?"Bronze Trainer":a.user.points.total<200?"Silver Trainer":a.user.points.total<500?"Gold Trainer":a.user.points.total<800?"Haciendo IO":a.user.points.total<1500?"Master of Food & Sports":a.user.points.total<3e3?"Aprobaste API":a.user.points.total<5e3?"Acabando EA":a.user.points.total<1e4?"4t de Carrera":a.user.points.total<15e3?"Digievolucionando":a.user.points.total<2e4?"4th Level Sayan":a.user.points.total<5e4?"Overlord":"Master of Universe"},a.showBackgroundImgDialog=function(b){d.show({controller:i,templateUrl:"views/user/backgroundImg.tmpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:a.customFullscreen})},a.showAvatarImgDialog=function(b){d.show({controller:i,templateUrl:"views/user/avatarImg.tmpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:a.customFullscreen})},a.showImgComplete=function(b,c){console.log(c),d.show({controller:i,templateUrl:"views/user/imgComplete.tmpl.html",locals:{urlImg:c},parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:a.customFullscreen})},a.arrayObjectIndexOf=function(a,b){if(a)for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},a.userInPetitions=function(){if(a.user.clientsPetitions)for(var b=0,c=a.user.clientsPetitions.length;b<c;b++)if(a.user.clientsPetitions[b].clientid===a.storageuser._id&&"pendent"===a.user.clientsPetitions[b].state)return b;return-1},a.userInClients=function(){if(a.user.clients)for(var b=0,c=a.user.clients.length;b<c;b++)if(a.user.clients[b].client._id===a.storageuser._id)return b;return-1},a.sendLikeToPublication=function(c,d){console.log(d),console.log("like - "+c.title),b({url:urlapi+"publications/"+c._id+"/like",method:"POST"}).then(function(b){console.log(b.data),e.success("liked publication");for(var c=0;c<a.user.publications.length;c++)a.user.publications[c]._id==b.data._id&&(a.user.publications[c]=b.data)},function(){e.error("Failed on posting like publication")})},a.sendDislikeToPublication=function(c,d){console.log(d),console.log("dislike - "+c.title),b({url:urlapi+"publications/"+c._id+"/dislike",method:"POST"}).then(function(b){console.log(b.data),e.success("disliked publication");for(var c=0;c<a.user.publications.length;c++)a.user.publications[c]._id==b.data._id&&(a.user.publications[c]=b.data)},function(){e.error("Failed on posting dislike publication")})},a.doFollow=function(){b({url:urlapi+"users/follow",method:"POST",data:{userid:a.user._id}}).then(function(b){console.log(b.data),a.user=b.data,f.reload()},function(){e.error("Failed on following user")})},a.doUnfollow=function(){b({url:urlapi+"users/unfollow",method:"POST",data:{userid:a.user._id}}).then(function(b){console.log(b.data),a.user=b.data,f.reload()},function(){e.error("Failed on unfollowing user")})},a.deletePublication=function(a,c){var g=d.confirm().title("Delete this publication?").textContent("Are you sure?").ariaLabel("Lucky day").targetEvent(a).ok("Yes, delete").cancel("Cancel");d.show(g).then(function(){b({url:urlapi+"publications/"+c,method:"Delete"}).then(function(a){console.log("response: "),console.log(a.data),e.success("Publication deleted!"),f.reload()},function(a){e.error("Failed on deleting publication")})},function(){e.info("Operation canceled")})},a.newValoration={},a.valorate=function(){console.log("a"),b({url:urlapi+"trainers/valorate/"+a.user._id,method:"POST",data:a.newValoration}).then(function(b){console.log(b.data),a.user=b.data},function(){e.error("Failed on valorating trainer")})},a.sendPetition=function(c){var g=d.prompt().title("Ask for routine").textContent("Describe the petition").placeholder("Hi, I want a routine to get prepared for an Ironman").ariaLabel("Dog name").initialValue("").targetEvent(c).ok("Send Petition").cancel("Cancel");d.show(g).then(function(c){b({url:urlapi+"users/sendPetitionToTrainer/"+a.user._id,method:"POST",data:{message:c}}).then(function(a){console.log("response: "),console.log(a.data),f.reload()},function(a){e.error("Failed on generating new petition")})},function(){e.info("Petition canceled")})},a.sendMessage=function(a){b({url:urlapi+"conversations",method:"POST",data:{userB:c.userid}}).then(function(a){console.log("response: "),console.log(a.data),h.location="#!/messages"},function(a){e.error("Failed on generating new petition")})}});