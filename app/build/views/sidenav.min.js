/*! fooddportsweb - v0.0.0 - 2017-01-22 */"use strict";angular.module("myApp.sidenav",["ngRoute","ngAnimate","toastr"]).config(["$routeProvider",function(a){a.when("/sidenav",{templateUrl:"views/sidenav.html",controller:"SidenavCtrl"})}]).controller("SidenavCtrl",function(a,b,c,d,e,f,g,h){function i(a,c,d,e,f,g,i){a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),a.newPost={},a.hide=function(){c.hide()},a.cancel=function(){c.cancel()},a.postSended=function(a){c.hide(a)},a.uploadFileAvatar=function(b,c){console.log(c);var e=new Date;a.title="Image ("+e.getDate()+" - "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+")",a.newPost.imgfile=b,a.newPost.imgfile&&b&&!b.$error&&(console.log(b),b.upload=f.upload({url:"https://api.cloudinary.com/v1_1/"+g.config().cloud_name+"/upload",data:{upload_preset:g.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title,file:b},headers:{"X-Access-Token":void 0}}).progress(function(a){b.progress=Math.round(100*a.loaded/a.total),b.status="Uploading... "+b.progress+"%"}).success(function(c,e,f,g){console.log(c.url),a.newPost.photo=c.url,d.photos=d.photos||[],c.context={custom:{photo:a.title}},b.result=c,d.photos.push(c)}).error(function(a,c,d,e){b.result=a}))},a.sendNewPost=function(){b({url:urlapi+"publications",method:"POST",data:a.newPost}).then(function(b){console.log(b),i.success("New post added to your timeline"),a.postSended(b.data),h.reload()},function(){i.error("Failed on adding post to your timeline")})}}localStorage.getItem("fs_web_token")?(console.log("user logged"),a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),b.get(urlapi+"users/"+a.storageuser._id).then(function(b){localStorage.setItem("fs_web_userdata",JSON.stringify(b.data)),a.storageuser=b.data},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){}),a.timer=setInterval(function(){b.get(urlapi+"notificationsNumber").then(function(b){console.log("notificationsNumber data success"),console.log(b),a.storageuser.notifications<b.data&&g.info("new notification!"),a.storageuser.pendentNotificationsNumber=b.data},function(a,b){console.log("data error"),console.log(b),console.log(a)}).then(function(a){})},1e4),a.loginData={},a.logout=function(){localStorage.removeItem("fs_web_token"),localStorage.removeItem("fs_web_userdata"),d.location="landingpage.html"},a.showNewPostDialog=function(b){f.show({controller:i,templateUrl:"views/newpost.tmpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:a.customFullscreen}).then(function(b){localStorage.setItem("fs_web_userdata",JSON.stringify(b)),a.storageuser=JSON.parse(localStorage.getItem("fs_web_userdata")),console.log("newpost dialog closed"),console.log(a.storageuser)},function(){})},a.searchstring="",a.goSearch=function(){d.location="#!/search/"+a.searchstring}):("#!/login"!=d.location&&"#!/signup"!=d.location||(console.log("user not logged"),d.location="/"),a.storageuser=null)});